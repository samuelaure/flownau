version: '3.8'

services:
  # Disable local database in production
  postgres:
    profiles: ["donotstart"]
  redis:
    profiles: ["donotstart"]

  # Override logic for the App
  app:
    networks:
      - shared-mesh
    environment:
      # Use the shared redis host for the queue
      - REDIS_HOST=shared_redis
      # Note: DATABASE_URL is expected to be provided via the server-side .env file

  # Override logic for the Worker
  worker:
    networks:
      - shared-mesh
    environment:
      - REDIS_HOST=shared_redis
      # Note: DATABASE_URL is expected to be provided via the server-side .env file     

# Connect to the external shared network
networks:
  shared-mesh:
    external: true
